 --CADASTRO DE PROMOÇÃO PROBLEMA A SER CORRIGIDO.
 
 --DEVOLUÇÃO 
 SELECT ZP1_PROD,B1_DESC,

(SELECT SUM(D1_TOTAL+D1_VALIPI+D1_VALFRE)VLTOT FROM SD1010 D1
 INNER JOIN SF4010 F4 ON F4_CODIGO=D1_TES AND F4_DUPLIC='S'AND F4.D_E_L_E_T_='' 
 WHERE D1_EMISSAO BETWEEN '20211120' AND '20211130'  AND D1_TIPO IN('D') AND D1_NFORI<>'' AND D1.D_E_L_E_T_=''
AND D1_COD=ZP1_PROD)DMES08,

(SELECT SUM(D1_QUANT)TTOT FROM SD1010 D1
 INNER JOIN SF4010 F4 ON F4_CODIGO=D1_TES AND F4_DUPLIC='S'AND F4.D_E_L_E_T_='' 
 WHERE D1_EMISSAO BETWEEN '20211120' AND '20211130'  AND D1_TIPO IN('D')AND D1_NFORI<>'' AND D1.D_E_L_E_T_=''  
AND D1_COD=ZP1_PROD)DTMES08

 FROM ZP1010 ZP1
 INNER JOIN SB1010 B1 ON B1_COD = ZP1_PROD AND B1.D_E_L_E_T_<>'*' 
 WHERE ZP1_PROMO = '0092'
 AND ZP1.D_E_L_E_T_<>'*'

ORDER BY ZP1_PROD, B1_DESC

--POR VENDEDOR E SETOR COM VALOR E N DE ITENS PREMIO VALOR 1 ITENS 1 MIN 500
SELECT ZP1_PROD,B1_DESC,

(SELECT SUM(D2_TOTAL+D2_VALIPI+D2_VALFRE)  AS VLTOT FROM SD2010 D2
INNER JOIN SF2010 F2 ON F2_DOC = D2_DOC AND F2_SERIE = D2_SERIE AND F2_EMISSAO = D2_EMISSAO AND F2_FILIAL = D2_FILIAL 
AND F2_DUPL <>'' AND F2_TIPO NOT IN ('D','B','P') AND F2.D_E_L_E_T_<>'*' 
AND F2_FILIAL = D2_FILIAL AND F2_SERIE <> '9'
WHERE D2_EMISSAO BETWEEN '20211120' AND '20211130'  
AND D2_TES NOT IN ('571') AND D2.D_E_L_E_T_ <> '*'
AND D2_COD =ZP1_PROD) MES08,

(SELECT SUM(D2_QUANT)  AS TTOT FROM SD2010 D2
INNER JOIN SF2010 F2 ON F2_DOC = D2_DOC AND F2_SERIE = D2_SERIE AND F2_EMISSAO = D2_EMISSAO AND F2_FILIAL = D2_FILIAL 
AND F2_DUPL <>'' AND F2_TIPO NOT IN ('D','B','P') AND F2.D_E_L_E_T_<>'*' 
AND F2_FILIAL = D2_FILIAL  AND F2_SERIE <> '9'
WHERE D2_EMISSAO BETWEEN '20211120' AND '20211130' 
AND D2_TES NOT IN ('571') AND D2.D_E_L_E_T_ <> '*'
AND D2_COD =ZP1_PROD) TMES08

,(SELECT SUM(B2_QATU) FROM SB2010 WHERE B2_COD =ZP1_PROD AND D_E_L_E_T_ <> '*' AND B2_FILIAL = '01' )  SDARA
,(SELECT SUM(B2_QATU) FROM SB2010 WHERE B2_COD =ZP1_PROD AND D_E_L_E_T_ <> '*' AND B2_FILIAL = '02' )  SDSCA

,(SELECT SUM(C7_QUANT-C7_QUJE) FROM SC7010 C7 WHERE C7.D_E_L_E_T_='' AND C7_PRODUTO=ZP1_PROD AND (C7_QUANT-C7_QUJE)>0 AND C7_RESIDUO<>'S') PREENT
FROM ZP1010 ZP1
INNER JOIN SB1010 B1 ON B1_COD = ZP1_PROD AND B1.D_E_L_E_T_<>'*' 
WHERE ZP1_PROMO = '0092'
--AND ZP1_PROD = '030320353'
AND ZP1.D_E_L_E_T_<>'*'
ORDER BY ZP1_PROD, B1_DESC

SELECT ZP1_PROD, B1_DESC  FROM ZP1010 ZP1
INNER JOIN SB1010 B1 ON B1_COD = ZP1_PROD AND B1.D_E_L_E_T_<>'*' 
WHERE ZP1_PROMO = '0093'